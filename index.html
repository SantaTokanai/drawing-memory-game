<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>記憶して描くお絵かき</title>
<style>
  body { text-align: center; font-family: sans-serif; }
  #sampleContainer, #canvasContainer, #outputContainer { margin: 20px auto; }
  canvas, img { border: 1px solid #000; display: block; margin: 10px auto; max-width: 90%; }
  button { margin: 5px; padding: 5px 10px; font-size: 16px; }
  #saveMessage { font-size: 14px; color: #555; }
</style>
</head>
<body>

<h2>見本を覚えて描いてみよう</h2>

<!-- 見本表示 -->
<div id="sampleContainer">
  <img id="sample" src="sample.png" width="300" height="300">
  <p>残り <span id="sampleCountdown">10</span> 秒</p>
</div>

<!-- 描画用キャンバス -->
<div id="canvasContainer" style="display:none;">
  <canvas id="drawCanvas" width="300" height="300"></canvas>
  <p>残り <span id="drawCountdown">60</span> 秒</p>
  <button id="showImg">描画完了</button>
  <button id="reset">リセット</button>
</div>

<!-- 描画後の画像 -->
<div id="outputContainer" style="display:none;">
  <img id="output" alt="描いた絵">
  <p id="saveMessage">長押しでカメラロールに保存できます</p>
</div>

<script>
const sampleContainer = document.getElementById('sampleContainer');
const sampleCountdown = document.getElementById('sampleCountdown');
const canvasContainer = document.getElementById('canvasContainer');
const drawCountdown = document.getElementById('drawCountdown');
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
ctx.lineWidth = 3;
ctx.lineCap = 'round';

let drawing = false;

// タッチやマウスの座標取得
function getPos(e) {
  const rect = canvas.getBoundingClientRect();
  if (e.touches) {
    return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
  } else {
    return { x: e.clientX - rect.left, y: e.clientY - rect.top };
  }
}

// 描画イベント
canvas.addEventListener('mousedown', e => { drawing = true; const pos = getPos(e); ctx.beginPath(); ctx.moveTo(pos.x, pos.y); });
canvas.addEventListener('mousemove', e => { if(!drawing) return; const pos = getPos(e); ctx.lineTo(pos.x, pos.y); ctx.stroke(); });
canvas.addEventListener('mouseup', e => { drawing = false; });
canvas.addEventListener('mouseleave', e => { drawing = false; });

canvas.addEventListener('touchstart', e => { drawing = true; const pos = getPos(e); ctx.beginPath(); ctx.moveTo(pos.x, pos.y); });
canvas.addEventListener('touchmove', e => { if(!drawing) return; const pos = getPos(e); ctx.lineTo(pos.x, pos.y); ctx.stroke(); e.preventDefault(); });
canvas.addEventListener('touchend', e => { drawing = false; });

// 見本カウントダウン 10 秒
let sampleTime = 10;
const sampleTimer = setInterval(() => {
  sampleTime--;
  sampleCountdown.textContent = sampleTime;
  if(sampleTime <= 0){
    clearInterval(sampleTimer);
    // 見本非表示、キャンバス表示
    sampleContainer.style.display = 'none';
    canvasContainer.style.display = 'block';
    startDrawCountdown();
  }
}, 1000);

// 描画カウントダウン 60 秒
function startDrawCountdown() {
  let drawTime = 60;
  drawCountdown.textContent = drawTime;
  const drawTimer = setInterval(() => {
    drawTime--;
    drawCountdown.textContent = drawTime;
    if(drawTime <= 0){
      clearInterval(drawTimer);
      // タイマー終了時に描画完了自動処理
      showImage();
    }
  }, 1000);
}

// 描画完了ボタン
document.getElementById('showImg').addEventListener('click', showImage);

function showImage() {
  const dataURL = canvas.toDataURL('image/png');
  const output = document.getElementById('output');
  output.src = dataURL;
  document.getElementById('outputContainer').style.display = 'block';
}

// リセットボタン
document.getElementById('reset').addEventListener('click', () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.beginPath();
  document.getElementById('output').src = '';
  document.getElementById('outputContainer').style.display = 'none';
});

</script>
</body>
</html>
